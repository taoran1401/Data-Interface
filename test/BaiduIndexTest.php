<?php
namespace Taoran\DataInterface\Test;

class BaiduIndexTest
{
    public function index()
    {
        //搜索词
        $word = [
            [
                [
                    'name' => 'php',
                    'wordType' => 1
                ],
                [
                    'name' => 'java',
                    'wordType' => 1
                ],
                [
                    'name' => 'golang',
                    'wordType' => 1
                ]

            ]
        ];

        //日期
        $startDate = '2011-01-01';
        $endDate = '2022-04-30';
        //地区：0 表示全国
        $area = 0;
        //cookie： cookie有时效，当无法访问出现请求阻塞时更换cookie可解决
        $cookie = 'CHKFORREG=27eec5721079530a30ebcd4cc39faa47; PSTM=1619529893; BIDUPSID=A7911A2514EB4CC3EE1425BEEC0979CC; __yjs_duid=1_edf34bb9feb9f05b03d967cb836def6f1619967340911; H_WISE_SIDS=107318_110085_127969_153067_179345_184716_185634_189256_189755_191067_192206_192391_192408_193284_194085_194512_194520_195329_195342_195468_196049_196428_196514_196528_197242_197711_197782_197958_198120_198254_198929_199022_199082_199467_199490_199574_200736_200763_200958_201054_201107_201187_201233_201361_201541_201556_201576_201705_201978_201996_202058_202111_202565_202652_202760_202904_202910_203197_203250_203267_203542_203606_203629_204032_204099_204102_204112_204131_204154_204205_204262_204371_204432; MCITY=-289%3A; BAIDUID=0387E1D3A675D372665603DAD7A82B26:SL=0:NR=10:FG=1; BDUSS=nZhfn5iaXVNOFdaRm41SDY3VXQ2TkdMWGN2bDlXV3ByZ1Q3YWdvZjQ5a0RscEZpSVFBQUFBJCQAAAAAAAAAAAEAAACedmtVx9bP~rih0~DO9AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMJamIDCWpie; BDUSS_BFESS=nZhfn5iaXVNOFdaRm41SDY3VXQ2TkdMWGN2bDlXV3ByZ1Q3YWdvZjQ5a0RscEZpSVFBQUFBJCQAAAAAAAAAAAEAAACedmtVx9bP~rih0~DO9AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMJamIDCWpie; Hm_up_d101ea4d2a5c67dab98251f0b5de24dc=%7B%22uid_%22%3A%7B%22value%22%3A%221433106078%22%2C%22scope%22%3A1%7D%7D; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; BAIDUID_BFESS=0387E1D3A675D372665603DAD7A82B26:SL=0:NR=10:FG=1; BA_HECTOR=250k012g01ag810lmj1h79tm60r; delPer=0; BDRCVFR[feWj1Vr5u3D]=I67x6TjHwwYf0; PSINO=6; H_PS_PSSID=36309_31660_35912_36166_34584_35978_36075_36297_36344_26350_36349_36061; BCLID=7040008288355075041; BDSFRCVID=XWPOJexroG0leprDJSmrMeKN9rpWxY5TDYrELPfiaimDVu-VJeC6EG0Pts1-dEu-EHtdogKK3gOTH4DF_2uxOjjg8UtVJeC6EG0Ptf8g0M5; H_BDCLCKID_SF=tR30WJbHMTrDHJTg5DTjhPrMWbJTWMT-MTryKKJs54JKshcbhJ5YbfPNeq5jLbvkJGnRh4oNBUJtjJjYhfO45DuZyxomtfQxtNRJQKDE5p5hKq5S5-OobUPUDUJ9LUkJ3gcdot5yBbc8eIna5hjkbfJBQttjQn3hfIkj2CKLK-oj-D8lDjAh3e; BCLID_BFESS=7040008288355075041; BDSFRCVID_BFESS=XWPOJexroG0leprDJSmrMeKN9rpWxY5TDYrELPfiaimDVu-VJeC6EG0Pts1-dEu-EHtdogKK3gOTH4DF_2uxOjjg8UtVJeC6EG0Ptf8g0M5; H_BDCLCKID_SF_BFESS=tR30WJbHMTrDHJTg5DTjhPrMWbJTWMT-MTryKKJs54JKshcbhJ5YbfPNeq5jLbvkJGnRh4oNBUJtjJjYhfO45DuZyxomtfQxtNRJQKDE5p5hKq5S5-OobUPUDUJ9LUkJ3gcdot5yBbc8eIna5hjkbfJBQttjQn3hfIkj2CKLK-oj-D8lDjAh3e; Hm_lvt_d101ea4d2a5c67dab98251f0b5de24dc=1650939213,1651116266,1651735463,1651893162; bdindexid=0kd1seiorrg2bm6gdj94rcueq7; Hm_lpvt_d101ea4d2a5c67dab98251f0b5de24dc=1651893169; ab_sr=1.0.1_OTUzNTI5NzdhZDFhYWU3MWM5OTZmZDJhMmM0NmFmNTk5YWM1MDhmN2Y1MWI3YmZmMWVlYTUxYTdlM2RmZWJmN2Y4YjY0MjBlMTNkNWJiYzY1NzZiMzllZjdhNmZiNmIxOWVlMWE4NDMzMmVkZDI5ZmI3ODg5OWUwM2I1MDFhNTJhNzY5YjlhODhjZGNiZDliY2NjMGI0ZTg0NmMyMzI3OQ==; __yjs_st=2_MzIwN2U3ZWJlY2Y4MjI4NzU4ZjI0ZjkxNGNjOWJkZjgyMjllNzI1N2JiNDYzZDg4OGM5OGVhYmQwZTRlNjNiYmIwNDY1MDI1ZDIzNDcyYTQ4MzhiY2E2MzlkNjc1YjcxODIxMjJlZWZkN2Y1MzA2YjA1YmRmMDhlZjE0MDQzMTExNWFmMzkyYzgxY2NmMWE1NmU4YjQwNmE0NGFiZWJhMDBjZTZjNTU4NzczMjM5ZTM0ZWE1NWY2MTU5YTI3Y2E3XzdfZDExMmYxYjY=; RT="z=1&dm=baidu.com&si=42d3bb6d-aef0-4d08-b3e7-954982e8b9ef&ss=l2vajd5a&sl=3&tt=5np&bcn=https%3A%2F%2Ffclog.baidu.com%2Flog%2Fweirwood%3Ftype%3Dperf&ld=98u"';

        //多年查询会出现数据异常，这里拆分年份后在查询
        $yearScope = \Taoran\DataInterface\Util::getDateByInterval($startDate, $endDate, 'year');
        $baiduIndex = new \Taoran\DataInterface\BaiduIndex();
        foreach ($yearScope as $key => $val) {

            $result = $baiduIndex->setCookie($cookie)->search($word, $val['startDate'], $val['endDate'], $area);

            // TODO: 这里可以添加自己的代码，比如写入到数据库，导出成csv
            var_dump($result);
            exit;
            sleep(3);
        }

        return true;
    }
}